provider "aws" {
region = "us-east-1"
}
resource "aws_security_group" "ec2-scg" {
name = "ece-scg-1"
description = "allow access on ports 8080 and 22"
ingress {
description = "http proxy access"
from_port = 8080
to_port = 8080
protocol = "tcp"
cidr_blocks = ["0.0.0.0/0"]
}
ingress {
description = "ssh access"
from_port = 22
to_port = 22
protocol = "tcp"
cidr_blocks = ["0.0.0.0/0"]
}
egress {
from_port = 0
to_port = 0
protocol = "tcp"
cidr_blocks = ["0.0.0.0/0"]
}
tags = {
name = "jenkins-server"
}
}
resource "aws_instance" "ec2-user-11" {
ami = "ami-080e1f13689e07408"
instance_type = "t2.micro"
vpc_security_group_ids = [aws_security_group.ec2-scg.id]
key_name = "debian"
tags = {
name = "jenbkis"
}
connection {
    type        = "ssh"
    user        = "ec2-user"
    private_key = file("C/Users/hp/Desktop")
    host        = self.public_ip
 }
provisioner "remote-exec" {
    inline = [
      "sudo apt-get update -y",
      "sudo wget -O /usr/share/keyrings/jenkins-keyring.asc https://pkg.jenkins.io/debian/jenkins.io.key",
      "echo \"deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian binary/\" | sudo tee /etc/apt/sources.list.d/jenkins.list > /dev/null",
      "sudo apt-get install -y fontconfig openjdk-11-jre jenkins",
      "sudo systemctl start jenkins",
      "sudo systemctl enable jenkins",
      "sudo systemctl status jenkins"
    ]
  }
}

OR

}
user_data = <<-EOF
      sudo yum update -y,
      sudo yum install -y java-1.8.0,
      sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo,
      sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key,
      sudo yum install -y jenkins,
      sudo systemctl start jenkins,
      sudo systemctl enable jenkins
EOF
}

( OR )

user_data = <<-EOF
      sudo yum update -y,
      sudo yum install -y java-1.8.0,
      sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo,
      sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key,
      sudo yum install -y jenkins,
      sudo systemctl start jenkins,
      sudo systemctl enable jenkins
EOF
}
